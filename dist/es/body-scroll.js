function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor;}function _classPrivateFieldGet(receiver,privateMap){var descriptor=privateMap.get(receiver);if(!descriptor){throw new TypeError("attempted to get private field on non-instance");}if(descriptor.get){return descriptor.get.call(receiver);}return descriptor.value;}function _classPrivateFieldSet(receiver,privateMap,value){var descriptor=privateMap.get(receiver);if(!descriptor){throw new TypeError("attempted to set private field on non-instance");}if(descriptor.set){descriptor.set.call(receiver,value);}else{if(!descriptor.writable){throw new TypeError("attempted to set read only private field");}descriptor.value=value;}return value;}function _typeof(obj){"@babel/helpers - typeof";if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof=function _typeof(obj){return typeof obj;};}else{_typeof=function _typeof(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj;};}return _typeof(obj);}var html=document.documentElement;var head=document.head;var eventNamePrefix="bodyscroll";var dispatchEvent=function dispatchEvent(element,messageName){return typeof window.CustomEvent==="function"?element===null||element===void 0?void 0:element.dispatchEvent(new CustomEvent("".concat(eventNamePrefix).concat(messageName))):function(){};};var isNumber=function isNumber(value){return typeof value==="number"&&!isNaN(value)&&isFinite(value);};var scrollSaving=new WeakMap();var isValidScrollPosition=function isValidScrollPosition(value){return _typeof(value)==="object"&&isNumber(value===null||value===void 0?void 0:value.top)&&isNumber(value===null||value===void 0?void 0:value.left);};var formatScrollPosition=function formatScrollPosition(value){return isValidScrollPosition(value)?value:null;};var restoreScrollPosition=function restoreScrollPosition(element,scroll){scroll=scroll!==undefined?scroll:getSavedScrollPosition(element);scroll=formatScrollPosition(scroll);if(scroll){element===null||element===void 0?void 0:element.scrollTo(scroll.left,scroll.top);}return scroll;};var saveScrollPosition=function saveScrollPosition(element,scroll){if(scroll===undefined){var _element$scrollTop,_element$scrollLeft;scroll={top:(_element$scrollTop=element===null||element===void 0?void 0:element.scrollTop)!==null&&_element$scrollTop!==void 0?_element$scrollTop:0,left:(_element$scrollLeft=element===null||element===void 0?void 0:element.scrollLeft)!==null&&_element$scrollLeft!==void 0?_element$scrollLeft:0};}scroll=formatScrollPosition(scroll);scrollSaving.set(element,scroll);return scroll;};var getSavedScrollPosition=function getSavedScrollPosition(element){var _scrollSaving$get;return(_scrollSaving$get=scrollSaving.get(element))!==null&&_scrollSaving$get!==void 0?_scrollSaving$get:null;};var clearSavedScrollPosition=function clearSavedScrollPosition(element){return scrollSaving["delete"](element);};var getBoundingProp=function getBoundingProp(element,prop){var _element$getBoundingC,_element$getBoundingC2;return(_element$getBoundingC=element===null||element===void 0?void 0:(_element$getBoundingC2=element.getBoundingClientRect())===null||_element$getBoundingC2===void 0?void 0:_element$getBoundingC2[prop])!==null&&_element$getBoundingC!==void 0?_element$getBoundingC:0;};var getWidth=function getWidth(element){return getBoundingProp(element,'width');};var getHeight=function getHeight(element){return getBoundingProp(element,'height');};var getScrollbarsGaps=function getScrollbarsGaps(element){var _element$style;var styles=(_element$style=element===null||element===void 0?void 0:element.style)!==null&&_element$style!==void 0?_element$style:{};styles.overflow="";var wasLocked=removeLockedCssClass(element);var width=getWidth(element);var height=getHeight(element);styles.overflow="hidden";var vertical=getWidth(element)-width;var horizontal=getHeight(element)-height;styles.overflow="";if(wasLocked){addLockedCssClass(element);}return{vertical:vertical,horizontal:horizontal};};var stylers=new WeakMap();var cssVarNamePositionTop="--body-scroll-lock-top-rect";var cssVarNamePositionLeft="--body-scroll-lock-left-rect";var cssVarNameGapVertical="--body-scroll-lock-vertical-scrollbar-gap";var cssVarNameGapHorizontal="--body-scroll-lock-horizontal-scrollbar-gap";var dataAttrName='data-body-scroll-lock';var clearStyle=function clearStyle(element){var _stylers$get;(_stylers$get=stylers.get(element))===null||_stylers$get===void 0?void 0:_stylers$get.remove();stylers["delete"](element);element.removeAttribute(dataAttrName);};var updateCssVariables=function updateCssVariables(element){if(!stylers.has(element)){stylers.set(element,document.createElement('style'));}var styler=stylers.get(element);if(!head.contains(styler)){head.append(styler);}if(!(element===null||element===void 0?void 0:element.matches("[".concat(dataAttrName,"]")))){element===null||element===void 0?void 0:element.setAttribute(dataAttrName,Date.now());}var index=0;if(styler.sheet.cssRules[index]){styler.sheet.deleteRule(index);}var scrollbarsGaps=getScrollbarsGaps(element);var scrollSaving=getSavedScrollPosition(element);var scrollPosition=isValidScrollPosition(scrollSaving)?scrollSaving:{top:0,left:0};var rule="[".concat(dataAttrName,"=\"").concat(element===null||element===void 0?void 0:element.getAttribute(dataAttrName),"\"] {\n        ").concat(cssVarNamePositionTop,": ").concat(scrollPosition.top*-1,"px;\n        ").concat(cssVarNamePositionLeft,": ").concat(scrollPosition.left*-1,"px;\n\n        ").concat(cssVarNameGapVertical,": ").concat(scrollbarsGaps.vertical,"px;\n        ").concat(cssVarNameGapHorizontal,": ").concat(scrollbarsGaps.horizontal,"px;\n        \n        ").concat(cssVarNameGapVertical,"-round: ").concat(Math.round(scrollbarsGaps.vertical),"px;\n        ").concat(cssVarNameGapHorizontal,"-round: ").concat(Math.round(scrollbarsGaps.horizontal),"px;\n    }");styler.sheet.insertRule(rule,index);};var lockedStateCssClass="body-scroll-lock";var toggleLockedCssClass=function toggleLockedCssClass(element,bool){var _element$classList,_bool,_element$classList2;var hadClass=!!(element===null||element===void 0?void 0:(_element$classList=element.classList)===null||_element$classList===void 0?void 0:_element$classList.contains(lockedStateCssClass));bool=(_bool=bool)!==null&&_bool!==void 0?_bool:!hadClass;element===null||element===void 0?void 0:(_element$classList2=element.classList)===null||_element$classList2===void 0?void 0:_element$classList2.toggle(lockedStateCssClass,bool);return bool&&!hadClass||!bool&&hadClass;};var addLockedCssClass=function addLockedCssClass(element){return toggleLockedCssClass(element,true);};var removeLockedCssClass=function removeLockedCssClass(element){return toggleLockedCssClass(element,false);};var lockStates=new WeakMap();var isLocked=function isLocked(element){return!!lockStates.get(element);};var doLock=function doLock(element){if(isLocked(element)){return false;}lockStates.set(element,true);if(!isValidScrollPosition(getSavedScrollPosition(element))){saveScrollPosition(element);}updateCssVariables(element);addLockedCssClass(element);return true;};var doUnlock=function doUnlock(element){if(!isLocked(element)){return false;}lockStates.set(element,false);removeLockedCssClass(element);restoreScrollPosition(element,getSavedScrollPosition(element));clearSavedScrollPosition(element);return true;};var _lock=function lock(element){if(!doLock(element)){return;}dispatchEvent(element,"lock");};var _unlock=function unlock(element){if(!doUnlock(element)){return;}dispatchEvent(element,"unlock");};var eventName="resize";var debounceTime=150;var id=null;var eventHandler=function eventHandler(element){clearTimeout(id);id=setTimeout(function(){if(!doUnlock(element)){return;}doLock(element);dispatchEvent(element,eventName);},debounceTime);};var options=true;var addResizeEventListener=function addResizeEventListener(element){return window.addEventListener(eventName,eventHandler(element),options);};var removeResizeEventListener=function removeResizeEventListener(element){return window.removeEventListener(eventName,eventHandler(element),options);};var _element=new WeakMap();var bodyScroll=function(){function bodyScroll(){var element=arguments.length>0&&arguments[0]!==undefined?arguments[0]:html;_classCallCheck(this,bodyScroll);_element.set(this,{writable:true,value:void 0});_classPrivateFieldSet(this,_element,element);this.update();addResizeEventListener(_classPrivateFieldGet(this,_element));}_createClass(bodyScroll,[{key:"destroy",value:function destroy(){this.unlock();clearStyle(_classPrivateFieldGet(this,_element));removeResizeEventListener(_classPrivateFieldGet(this,_element));var validElement=!!_classPrivateFieldGet(this,_element);_classPrivateFieldSet(this,_element,null);return validElement;}},{key:"lock",value:function lock(){return _lock(_classPrivateFieldGet(this,_element));}},{key:"unlock",value:function unlock(){return _unlock(_classPrivateFieldGet(this,_element));}},{key:"update",value:function update(){return updateCssVariables(_classPrivateFieldGet(this,_element));}},{key:"save",value:function save(){return saveScrollPosition(_classPrivateFieldGet(this,_element));}},{key:"restore",value:function restore(){return restoreScrollPosition(_classPrivateFieldGet(this,_element));}},{key:"state",get:function get(){return isLocked(_classPrivateFieldGet(this,_element));}},{key:"scroll",get:function get(){return getSavedScrollPosition(_classPrivateFieldGet(this,_element));}},{key:"scrollbar",get:function get(){return getScrollbarsGaps(_classPrivateFieldGet(this,_element));}}]);return bodyScroll;}();export default bodyScroll;//# sourceMappingURL=body-scroll.js.map
